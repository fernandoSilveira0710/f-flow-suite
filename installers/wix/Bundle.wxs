<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:bal="http://schemas.microsoft.com/wix/BalExtension" xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
  <!-- Bootstrapper (Burn) para instalar Node.js como pré-requisito e o MSI do F-Flow -->
<Bundle Name="$(var.ProductName)" Version="1.0.6.0" Manufacturer="$(var.Manufacturer)" UpgradeCode="B58A4A15-6F3B-4F74-9E3D-9C3ACB9F3A11" Compressed="yes">
    <BootstrapperApplicationRef Id="WixStandardBootstrapperApplication.RtfLicense" />

    <!-- Detecção de instalação: usa valor gravado pelo MSI em HKLM para sinalizar 'já instalado' -->
    <util:RegistrySearch Id="InstalledVersionReg" Root="HKLM" Key="Software\F-Flow\Installer" Value="InstalledVersion" Variable="InstalledVersion" />

  <Chain>
      <!-- Node.js MSI (exemplo: Node 18 x64). Embutido no bootstrapper -->
      <MsiPackage Id="NodeJs" DisplayName="Node.js Runtime" Compressed="yes" Vital="yes" Permanent="yes" EnableFeatureSelection="no" SourceFile="node-v18.19.1-x64.msi" />

      <!-- MSI principal do F-Flow Suite (gerado a partir de Product.wxs, embutido) -->
      <MsiPackage Id="FflowMsi" DisplayName="F-Flow Suite" Compressed="yes" Vital="yes" Permanent="no" EnableFeatureSelection="no" SourceFile="out-wpf\FFlowSuite.msi" />

      <!-- Removido helper de desinstalação para evitar execução de UI durante instalação -->
    </Chain>
  </Bundle>
</Wix>